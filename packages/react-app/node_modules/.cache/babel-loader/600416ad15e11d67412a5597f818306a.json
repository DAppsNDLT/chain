{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst wallet_1 = require(\"../wallet\");\n\nconst permissions_1 = require(\"../types/permissions\");\n\nconst hasPermission = (required, permissions) => permissions.some(permission => permission.parentCapability === required);\n\nconst requirePermission = () => (_, propertyKey, descriptor) => {\n  const originalMethod = descriptor.value;\n\n  descriptor.value = async function () {\n    // @ts-expect-error accessing private property from decorator. 'this' context is the class instance\n    const wallet = new wallet_1.Wallet(this.communicator);\n    let currentPermissions = await wallet.getPermissions();\n\n    if (!hasPermission(propertyKey, currentPermissions)) {\n      currentPermissions = await wallet.requestPermissions([{\n        [propertyKey]: {}\n      }]);\n    }\n\n    if (!hasPermission(propertyKey, currentPermissions)) {\n      throw new permissions_1.PermissionsError('Permissions rejected', permissions_1.PERMISSIONS_REQUEST_REJECTED);\n    }\n\n    return originalMethod.apply(this);\n  };\n\n  return descriptor;\n};\n\nexports.default = requirePermission;","map":{"version":3,"sources":["../../../src/decorators/requirePermissions.ts"],"names":[],"mappings":";;;;;;AAEA,MAAA,QAAA,GAAA,OAAA,CAAA,WAAA,CAAA;;AAEA,MAAA,aAAA,GAAA,OAAA,CAAA,sBAAA,CAAA;;AAEA,MAAM,aAAa,GAAG,CAAC,QAAD,EAAoB,WAApB,KACpB,WAAW,CAAC,IAAZ,CAAkB,UAAD,IAAgB,UAAU,CAAC,gBAAX,KAAgC,QAAjE,CADF;;AAGA,MAAM,iBAAiB,GAAG,MAAM,CAAC,CAAD,EAAa,WAAb,EAAkC,UAAlC,KAAoE;AAClG,QAAM,cAAc,GAAG,UAAU,CAAC,KAAlC;;AAEA,EAAA,UAAU,CAAC,KAAX,GAAmB,kBAAK;AACtB;AACA,UAAM,MAAM,GAAG,IAAI,QAAA,CAAA,MAAJ,CAAY,KAAc,YAA1B,CAAf;AAEA,QAAI,kBAAkB,GAAG,MAAM,MAAM,CAAC,cAAP,EAA/B;;AAEA,QAAI,CAAC,aAAa,CAAC,WAAD,EAAyB,kBAAzB,CAAlB,EAAgE;AAC9D,MAAA,kBAAkB,GAAG,MAAM,MAAM,CAAC,kBAAP,CAA0B,CAAC;AAAE,SAAC,WAAD,GAA0B;AAA5B,OAAD,CAA1B,CAA3B;AACD;;AAED,QAAI,CAAC,aAAa,CAAC,WAAD,EAAyB,kBAAzB,CAAlB,EAAgE;AAC9D,YAAM,IAAI,aAAA,CAAA,gBAAJ,CAAqB,sBAArB,EAA6C,aAAA,CAAA,4BAA7C,CAAN;AACD;;AAED,WAAO,cAAc,CAAC,KAAf,CAAqB,IAArB,CAAP;AACD,GAfD;;AAiBA,SAAO,UAAP;AACD,CArBD;;AAuBA,OAAA,CAAA,OAAA,GAAe,iBAAf","sourceRoot":"","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst wallet_1 = require(\"../wallet\");\nconst permissions_1 = require(\"../types/permissions\");\nconst hasPermission = (required, permissions) => permissions.some((permission) => permission.parentCapability === required);\nconst requirePermission = () => (_, propertyKey, descriptor) => {\n    const originalMethod = descriptor.value;\n    descriptor.value = async function () {\n        // @ts-expect-error accessing private property from decorator. 'this' context is the class instance\n        const wallet = new wallet_1.Wallet(this.communicator);\n        let currentPermissions = await wallet.getPermissions();\n        if (!hasPermission(propertyKey, currentPermissions)) {\n            currentPermissions = await wallet.requestPermissions([{ [propertyKey]: {} }]);\n        }\n        if (!hasPermission(propertyKey, currentPermissions)) {\n            throw new permissions_1.PermissionsError('Permissions rejected', permissions_1.PERMISSIONS_REQUEST_REJECTED);\n        }\n        return originalMethod.apply(this);\n    };\n    return descriptor;\n};\nexports.default = requirePermission;\n//# sourceMappingURL=requirePermissions.js.map"]},"metadata":{},"sourceType":"script"}